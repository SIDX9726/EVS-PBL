<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>City Carbon Emission Comparator (2015-2025)</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body{font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial;margin:24px;background:linear-gradient(180deg,#ebf8ed,#f7fff2)}
    .card{max-width:980px;margin:0 auto;background:#fff;padding:20px;border-radius:12px;box-shadow:0 6px 24px rgba(20,40,0,0.08)}
    h1{margin:0 0 8px;font-size:20px}
    p.lead{margin:0 0 18px;color:#2d6a3d}
    .controls{display:flex;flex-wrap:wrap;gap:12px;align-items:center}
    select,input,button{padding:8px 10px;border-radius:8px;border:1px solid #cfe9cf}
    button{background:#2e8b57;color:#fff;border:none;cursor:pointer}
    button:disabled{opacity:0.5;cursor:not-allowed}
    .chart-wrap{margin-top:18px}
    .row{display:flex;gap:12px;margin-top:12px;justify-content:space-between;align-items:center}
    .col{flex:1}
    .small{font-size:13px;color:#555}
    .insight{margin-top:12px;padding:12px;border-radius:8px;background:#f4fff4;color:#133a1a}
  </style>
</head>
<body>
  <div class="card">
    <h1>City Carbon Emission Comparator — 2015 to 2025</h1>
    <p class="lead">Select two cities (from India, USA, China). The chart shows per-capita CO₂ (tonnes/person/year) over the chosen year range. Use the PDF button to export the current view.</p>

    <div class="controls">
      <label class="small">City A:</label>
      <select id="countryA"></select>
      <select id="cityA"></select>

      <label class="small">City B:</label>
      <select id="countryB"></select>
      <select id="cityB"></select>

      <label class="small">Year range:</label>
      <select id="startYear"></select>
      <select id="endYear"></select>

      <button id="compareBtn">Compare</button>
      <button id="pdfBtn">Download PDF</button>
    </div>

    <div class="chart-wrap">
      <canvas id="citiesChart"></canvas>
    </div>

    <div class="row">
      <div class="col">
        <div class="insight" id="insightBox">No comparison yet — choose cities and click Compare.</div>
      </div>
      <div class="col small" style="text-align:right">
        <strong>Made by Siddharth</strong><br>
        <a href="https://github.com/SIDX9726" target="_blank">github.com/SIDX9726</a>
      </div>
    </div>
  </div>

<script>
// --- Configuration: available countries and cities ---
const meta = {
  India: ['Delhi','Mumbai'],
  USA: ['New York','Los Angeles'],
  China: ['Beijing','Shanghai']
};

// --- Example city time-series data for years 2015..2025 (11 points) ---
const citySeries = {
  'Delhi':   [1.20,1.28,1.35,1.42,1.48,1.52,1.60,1.65,1.70,1.80,1.90],
  'Mumbai':  [1.10,1.15,1.20,1.24,1.30,1.34,1.38,1.40,1.45,1.50,1.60],
  'New York':[15.8,15.5,15.1,14.8,14.5,14.4,14.2,14.0,13.8,13.6,13.5],
  'Los Angeles':[10.5,10.3,10.0,9.8,9.6,9.4,9.3,9.1,8.9,8.7,8.5],
  'Beijing': [6.9,7.1,7.4,7.6,7.9,8.1,8.2,8.3,8.4,8.45,8.5],
  'Shanghai':[7.2,7.3,7.5,7.6,7.8,7.9,8.0,8.05,8.1,8.15,8.2]
};

const years = Array.from({length:11},(_,i)=>2015+i);

const countryA = document.getElementById('countryA');
const countryB = document.getElementById('countryB');
const cityA = document.getElementById('cityA');
const cityB = document.getElementById('cityB');
const startYear = document.getElementById('startYear');
const endYear = document.getElementById('endYear');
const compareBtn = document.getElementById('compareBtn');
const pdfBtn = document.getElementById('pdfBtn');
const insightBox = document.getElementById('insightBox');

function populateCountries(){
  Object.keys(meta).forEach(c=>{
    const o1 = document.createElement('option'); o1.value=c; o1.textContent=c; countryA.appendChild(o1);
    const o2 = document.createElement('option'); o2.value=c; o2.textContent=c; countryB.appendChild(o2);
  });
}

function populateCities(countrySelect, citySelect){
  citySelect.innerHTML = '';
  const cities = meta[countrySelect.value];
  cities.forEach(ct=>{ const o=document.createElement('option'); o.value=ct; o.textContent=ct; citySelect.appendChild(o); });
}

function populateYears(){
  years.forEach(y=>{ const a=document.createElement('option'); a.value=y; a.textContent=y; startYear.appendChild(a); });
  years.forEach(y=>{ const a=document.createElement('option'); a.value=y; a.textContent=y; endYear.appendChild(a); });
  startYear.value = 2015; endYear.value = 2025;
}

populateCountries();
populateCities(countryA, cityA);
populateCities(countryB, cityB);
populateYears();

countryA.addEventListener('change', ()=>populateCities(countryA, cityA));
countryB.addEventListener('change', ()=>populateCities(countryB, cityB));

let citiesChart;
function createChart(labels, datasets){
  const ctx = document.getElementById('citiesChart').getContext('2d');
  if(citiesChart) citiesChart.destroy();
  citiesChart = new Chart(ctx,{
    type: 'line',
    data:{ labels, datasets },
    options:{
      responsive:true,
      interaction: {mode:'index', intersect:false},
      stacked:false,
      plugins:{title:{display:true,text:'City CO₂ per-capita (tonnes/person/year)'}},
      scales:{y:{beginAtZero:true,title:{display:true,text:'Tonnes CO₂ per capita'}}}
    }
  });
}

function sliceByRange(series, startY, endY){
  const sIndex = years.indexOf(startY);
  const eIndex = years.indexOf(endY);
  return series.slice(sIndex, eIndex+1);
}

function colorFor(i){
  const palette = ['#2E8B57','#0074D9','#FF4136','#FF851B','#6F42C1','#E83E8C'];
  return palette[i%palette.length];
}

compareBtn.addEventListener('click', ()=>{
  const A = cityA.value; const B = cityB.value;
  const sy = parseInt(startYear.value); const ey = parseInt(endYear.value);
  if(years.indexOf(sy)===-1||years.indexOf(ey)===-1||sy>ey){ alert('Choose a valid start/end year'); return; }

  const labels = years.filter(y=>y>=sy && y<=ey);
  const seriesA = sliceByRange(citySeries[A], sy, ey);
  const seriesB = sliceByRange(citySeries[B], sy, ey);

  const datasets = [
    { label: A, data: seriesA, borderColor: colorFor(0), backgroundColor: colorFor(0), tension:0.2, fill:false, pointRadius:4 },
    { label: B, data: seriesB, borderColor: colorFor(1), backgroundColor: colorFor(1), tension:0.2, fill:false, pointRadius:4 }
  ];

  createChart(labels, datasets);

  const pctChange = (arr)=>(((arr[arr.length-1]-arr[0])/arr[0])*100).toFixed(1);
  const changeA = pctChange(seriesA); const changeB = pctChange(seriesB);
  const latestA = seriesA[seriesA.length-1].toFixed(2); const latestB = seriesB[seriesB.length-1].toFixed(2);

  let compText = `${A} changed ${changeA}% from ${labels[0]} to ${labels[labels.length-1]} (latest: ${latestA} tCO₂/person).\n`;
  compText += `${B} changed ${changeB}% from ${labels[0]} to ${labels[labels.length-1]} (latest: ${latestB} tCO₂/person).\n`;

  if(parseFloat(latestA) > parseFloat(latestB)) compText += `\n⇒ ${A} has higher per-capita emissions than ${B} in ${labels[labels.length-1]}.`;
  else if(parseFloat(latestA) < parseFloat(latestB)) compText += `\n⇒ ${B} has higher per-capita emissions than ${A} in ${labels[labels.length-1]}.`;
  else compText += `\n⇒ Both cities have similar per-capita emissions in ${labels[labels.length-1]}.`;

  insightBox.textContent = compText;
});

pdfBtn.addEventListener('click', async ()=>{
  if(!citiesChart){ alert('Please run a comparison first.'); return; }
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF({orientation:'landscape'});

  pdf.setFontSize(16); pdf.text('City Carbon Emission Report (2015-2025)',14,16);
  pdf.setFontSize(10);
  pdf.text(`Compared: ${cityA.value} vs ${cityB.value}`,14,24);

  const img = citiesChart.toBase64Image();
  pdf.addImage(img,'PNG',14,30,270,140);

  pdf.setFontSize(10);
  const lines = pdf.splitTextToSize(insightBox.textContent, 270);
  pdf.text(lines,14,178);

  const now = new Date().toLocaleString();
  pdf.setFontSize(8); pdf.text(`Generated: ${now}`,14,200);

  pdf.save(`city_emissions_${cityA.value}_vs_${cityB.value}.pdf`);
});

window.addEventListener('load', ()=>{ compareBtn.click(); });
</script>
</body>
</html>